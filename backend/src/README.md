# /backend/src ディレクトリ運用マニュアル

本プロジェクトのバックエンド（Flask + SQLAlchemy）におけるディレクトリ構造と、その役割・運用ルールをまとめます。


## ディレクトリ構造
```shell
src/
├── app.py
├── dummy_data/
├── examples/
├── routes/
├── services/
├── static/
├── templates/
├── test/
└── utils/
```

## 各ディレクトリ・ファイルの役割

### app.py
- Flask アプリケーションのエントリーポイント。
- Blueprint の登録やアプリ全体の設定をここで行う。
- 開発サーバ起動時は `python src/app.py` で実行可能。

### dummy_data/
- Google Cloud 上にダミーデータを生成するプログラムを格納
- Google Cloud の全てのデータを初期化するコード

### examples/
- 接続や機能確認用のサンプルコードを格納。
- DB 接続テスト、API 呼び出し例、位置情報取得など。
- 実運用コードではなく **学習・動作確認用** として利用する。

### routes/
- Flask の **ルーティング層**。
- API エンドポイントの定義を行う (`/api/posts` など)。
- **役割**: リクエストの受け口・入力検証・サービス呼び出し。
- ここでは DB 処理は書かず、services 層に委譲する。

### services/
- **ビジネスロジック層**。
- DB モデル定義（SQLAlchemy ORM クラス）と、DB を用いた処理を実装。
- 例: PostService (投稿の作成・取得・削除など)。
- routes から呼ばれることを前提に設計する。

### static/
- フロントエンドで利用する **静的ファイル** を配置。
- CSS, JavaScript, 画像ファイルなど。
- Flask は `/static/...` で自動配信する。

### templates/
- Flask の **Jinja2 テンプレート** を配置。
- HTML を記述し、サーバ側でレンダリングされる。
- 例: `index.html` はルートページのビューで使用。

### test/
- **pytest 用テストコード** を格納。
- DB を直接叩かず、モックを使った単体テストを実装する。
- 命名規則: `test_*.py`
- 運用ルール: PR 作成前に `pytest` を通す。

### utils/
- **ユーティリティ層**。
- 再利用可能な小規模関数・DB 接続管理など。
- `db/` 内には Cloud SQL 接続ロジックなどをまとめて配置。
- 他層から呼び出され、共通処理を一元管理する。


## 運用ルール

1. **責務分離**
   - routes: API の入り口（HTTP リクエスト → サービス呼び出し）
   - services: ビジネスロジック・DB アクセス
   - utils: 共通関数や外部接続管理

2. **テスト**
   - test/ ディレクトリ以下に必ずテストを書く。
   - DB への保存を伴う処理はモック化し、CI 上で安全に実行できるようにする。

3. **サンプルコード**
   - examples/ 内のコードは本番に組み込まない。
   - 動作確認・検証用に留める。

4. **静的ファイル・テンプレート**
   - static/: CSS や JS はここに置く。
   - templates/: HTML テンプレートはここに置く。
   - app.py から Flask 標準の仕組みで利用可能。

## 開発フローの推奨

1. routes に新しいエンドポイントを追加する
2. services に必要な処理を実装する
3. utils に共通処理があれば切り出す
4. test に対応するテストを書く
5. pytest を実行してテストを通す
6. examples で動作確認（必要に応じて）